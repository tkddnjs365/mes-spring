<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mes.mes_boot.system.common.mapper.CommonMapper">
    <!-- 공통데이터 조회 -->
    <select id="getCommon" resultType="com.mes.mes_boot.system.common.dto.CommonDto">
        SELECT A.data_id As dataId
        , A.company_idx As companyIdx
        , A.group_id As groupId
        , A.key_id As keyId
        , A.value As value
        , A.description As description
        , A.sort_order As sortOrder
        , A.use_yn As useYn
        FROM common_code A
        WHERE 1 = 1
        <if test="groupId != null and groupId != ''">
            AND group_id = #{groupId}
        </if>
        <if test="useYn != null and useYn != ''">
            AND use_yn = #{useYn}
        </if>
        <if test="companyIdx != null and companyIdx != ''">
            AND company_idx = #{companyIdx}
        </if>
    </select>

    <!-- 회사별 공통데이터 그룹별 데이터 조회 -->
    <select id="getCompGroupDtl" resultType="com.mes.mes_boot.system.common.dto.CommonDto">
        SELECT A.data_id As dataId
        , A.company_idx As companyIdx
        , A.group_id As groupId
        , A.key_id As keyId
        , A.value As value
        , A.description As description
        , A.sort_order As sortOrder
        , A.use_yn As useYn
        FROM common_code A
        WHERE 1 = 1
        <if test="groupId != null and groupId != ''">
            AND group_id = #{groupId}
        </if>
        <if test="companyIdx != null and companyIdx != ''">
            AND company_idx = #{companyIdx}
        </if>
    </select>

    <!-- 공통코드 등록 -->
    <insert id="insertCommon" parameterType="map">
        INSERT INTO common_code (data_id, company_idx, group_id, key_id, value, description, sort_order, use_yn)
        SELECT CONCAT(#{groupId}, '.', #{keyId})
             , #{companyIdx}
             , #{groupId}
             , #{keyId}
             , #{value}
             , NULL
             , #{sortOrder}
             , #{useYn}
    </insert>

    <!-- 공통코드 삭제 -->
    <delete id="deleteCommon" parameterType="map">
        DELETE
        FROM common_code
        WHERE data_id = #{dataId}
          AND company_idx = #{companyIdx}
    </delete>

    <!-- 공통코드 수정 -->
    <update id="updateCommon" parameterType="map">
        UPDATE common_code
        SET value      = #{value}
          , sort_order = #{sortOrder}
          , use_yn     = #{useYn}
        WHERE data_id = #{dataId}
          AND company_idx = #{data_id}
    </update>
</mapper>